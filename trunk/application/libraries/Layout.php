<?php  if (!defined('BASEPATH')) exit('No direct script access allowed');/** * $this->layout->view($viewUrl = '', $data=''); // $this->obj->ViewData; 自动判断 viewUrl; * $this->layout->redirect($url, $msg='', $type='notice'); $type notice success error */class Layout{    var $obj;    var $layout;        function __construct()    {        $this->obj =& get_instance();				// 默認加載 jNotify -- 提示框		$this->loadJs('jNotify');    }	// ------------------------------------------------------------------------		/**	 * 設置模板	 */    function setLayout($layout='main')    {		$this->layout	= $layout;    }		// ------------------------------------------------------------------------		/**	 * 加載Js	 * 配合 js_helper 使用	 */	function loadJs($jsName) 	{		if(!empty($this->obj->ViewData['_loadJs']))			$loadJsList = $this->obj->ViewData['_loadJs'];		else			$loadJsList = array();				if ( ! empty($jsName) && ! in_array($jsName,$loadJsList)) {			$this->obj->ViewData['_loadJs'][] = $jsName;		}	}    	// ------------------------------------------------------------------------		/**	 * 加載view文件。	 *	 * $data 默認是 CI_Controller 子類的屬性 ViewData。	 * $view 默認是 根據 CI_Controller屬性 uri 分析出。user/login 對應 user/login.php view文件	 */    function view($view='', $data='', $return=false)    {		if(empty($data))			$data =& $this->obj->ViewData;        		if(empty($view)) {			$uri =& $this->obj->uri;						$view = $uri->segments[1];						if(empty($view))				$view = $uri->rsegments[1].'/'.$uri->rsegments[2];			else				$view .= '/'.$uri->rsegments[1].'/'.$uri->rsegments[2];		}		        $data['_content_for_layout'] = $this->obj->load->view($view,$data,true);		if($return) {            $output = $this->obj->load->view($this->layout, $data, true);            return $output;        } else {            $this->obj->load->view($this->layout, $data, false);        }    }		// ------------------------------------------------------------------------		/**	 * 使用 jNotify 跳轉并提示	 */	function redirect($url, $msg='', $type='notice', $autoHide='')	{		if( empty($url) )		{			redirect($url);						return true;		}				switch ($type)		{			case 'notice':				if ($autoHide==='') {					$autoHide = true;				}								DeepCI_Page_Message::Notice($url, $msg, $autoHide);								break;			case 'success':				if ($autoHide==='') {					$autoHide = true;				}								DeepCI_Page_Message::Success($url, $msg, $autoHide);								break;			case 'error':				if ($autoHide==='') {					$autoHide = false;				}								DeepCI_Page_Message::Error($url, $msg, $autoHide);								break;			default:				redirect($url);		}				return true;	}}